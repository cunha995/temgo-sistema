<script>
function enviarCodigoEmail() {
    // 1. Captura os dados do formulário
    const emailCliente = document.getElementById('email').value;
    const nomeCliente = document.getElementById('nome').value;
    
    // 2. Cria o código de 4 dígitos e salva para conferir depois
    const codigoSorteado = Math.floor(1000 + Math.random() * 9000);
    localStorage.setItem('codigo_ativo', codigoSorteado);

    // 3. Monta os parâmetros EXATAMENTE como estão no seu template
    const templateParams = {
        email: emailCliente, // Deve ser igual ao {{email}} da sua imagem
        to_name: nomeCliente,
        message: "Seu código de acesso TemGo é: " + codigoSorteado
    };

    // 4. ENVIO REAL (Usando o Service ID da sua imagem)
    // IMPORTANTE: Mude 'SEU_TEMPLATE_ID' pelo ID que aparece na lista do EmailJS
    emailjs.send('service_djujbji', 'SEU_TEMPLATE_ID', templateParams)
        .then(function(response) {
           console.log('SUCESSO!', response.status, response.text);
           alert("Código enviado com sucesso!");
           // Abre o modal de verificação para destravar a tela
           document.getElementById('modal-codigo').style.display = 'flex';
        })
        .catch(function(error) {
           console.error('FALHA NO ENVIO...', error);
           alert("Erro ao enviar e-mail: " + JSON.stringify(error));
           // Mesmo com erro, vamos abrir o modal para você não ficar travado no teste
           document.getElementById('modal-codigo').style.display = 'flex';
        });
}

function validarCodigo() {
    const digitado = document.getElementById('codigo-input').value;
    const correto = localStorage.getItem('codigo_ativo');

    if (digitado == correto) {
        // Salva que o usuário está logado
        localStorage.setItem('usuario_logado', 'true');
        // Redireciona para o mapa
        window.location.replace("passageiro.html");
    } else {
        alert("Código inválido! Tente novamente.");
    }
}
</script>
