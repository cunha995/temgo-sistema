<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TemGo - Cadastro Seguro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          // Sua chave pública real identificada na imagem
          emailjs.init("yTaC6x7E7XeVv4Am3");
       })();
    </script>

    <style>
        :root { --yellow: #FFD700; --bg: #000; --input: #121212; }
        body { margin: 0; padding: 20px; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 400px; padding-bottom: 50px; }
        header { text-align: center; margin-bottom: 25px; }
        .logo { color: var(--yellow); font-size: 40px; font-weight: bold; margin: 0; }
        
        /* Foto de Perfil */
        .profile-pic-container { text-align: center; margin-bottom: 20px; }
        .profile-circle {
            width: 120px; height: 120px; background: var(--input); border: 2px solid var(--yellow);
            border-radius: 50%; margin: 0 auto 10px; position: relative;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .profile-circle img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .profile-circle i { font-size: 40px; color: #444; }
        .profile-circle input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--yellow); font-size: 14px; font-weight: bold; }
        input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; background: var(--input); color: white; box-sizing: border-box; font-size: 16px; outline: none; }
        input:focus { border-color: var(--yellow); }

        .btn-principal { width: 100%; padding: 18px; background: var(--yellow); color: black; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 16px; margin-top: 10px; }
        
        /* Modal de Confirmação */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #181818; width: 85%; padding: 30px; border-radius: 20px; border: 1px solid var(--yellow); text-align: center; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="logo">TemGO</div>
            <p style="color: #888;">Cadastre-se para solicitar viagens</p>
        </header>

        <form onsubmit="enviarCodigoVerificacao(); return false;">
            <div class="profile-pic-container">
                <div class="profile-circle">
                    <i class="fa-solid fa-user" id="profile-icon"></i>
                    <img id="profile-img">
                    <input type="file" accept="image/*" capture="camera" required onchange="previewFoto(this)">
                </div>
                <label style="color: #666; font-size: 12px; font-weight: normal;">Toque para foto de perfil</label>
            </div>

            <div class="form-group"><label>Nome Completo</label><input type="text" id="nome" placeholder="Seu nome" required></div>
            <div class="form-group"><label>CPF</label><input type="text" id="cpf" placeholder="000.000.000-00" required></div>
            <div class="form-group"><label>Número de Telefone</label><input type="tel" id="tel" placeholder="(00) 00000-0000" required></div>
            <div class="form-group"><label>E-mail de Confirmação</label><input type="email" id="email" placeholder="seu@email.com" required></div>

            <button type="submit" class="btn-principal">AVANÇAR</button>
        </form>
    </div>

    <div id="modal-verificar" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--yellow);">Código Enviado</h2>
            <p style="color: #bbb; font-size: 14px;">Insira o código de 4 dígitos enviado ao seu e-mail para validar seu acesso.</p>
            <input type="text" id="codigo-input" maxlength="4" style="width: 140px; text-align: center; font-size: 30px; background: #000; color: #fff; margin: 20px 0; border: 1px solid var(--yellow); letter-spacing: 5px;">
            <button class="btn-principal" onclick="validarFinal()">CONFIRMAR E VIAJAR</button>
        </div>
    </div>

    <script>
        // Função para visualizar a foto tirada
        function previewFoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profile-img').src = e.target.result;
                    document.getElementById('profile-img').style.display = 'block';
                    document.getElementById('profile-icon').style.display = 'none';
                    localStorage.setItem('user_foto', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Envio real do e-mail com o código
        function enviarCodigoVerificacao() {
            const email = document.getElementById('email').value;
            const nome = document.getElementById('nome').value;
            
            // Gera o código aleatório
            const codigo = Math.floor(1000 + Math.random() * 9000);
            localStorage.setItem('codigo_ativo', codigo);

            const templateParams = {
                email: email, // Corresponde ao {{email}} no seu template
                to_name: nome,
                message: "Seu código de acesso TemGo é: " + codigo
            };

            // IDs do seu painel EmailJS
            // IMPORTANTE: Use o ID do seu template "One-Time Password"
            emailjs.send('service_djujbji', 'template_default', templateParams)
                .then(() => {
                    alert("Código de segurança enviado!");
                    document.getElementById('modal-verificar').style.display = 'flex';
                })
                .catch((err) => {
                    console.error("Erro:", err);
                    alert("Erro ao enviar e-mail. Mas vamos avançar para teste: O código é " + codigo);
                    document.getElementById('modal-verificar').style.display = 'flex';
                });
        }

        // Validação final e redirecionamento
        function validarFinal() {
            const digitado = document.getElementById('codigo-input').value;
            const correto = localStorage.getItem('codigo_ativo');

            if (digitado == correto) {
                // Salva todos os dados localmente
                const dados = {
                    nome: document.getElementById('nome').value,
                    cpf: document.getElementById('cpf').value,
                    tel: document.getElementById('tel').value,
                    email: document.getElementById('email').value,
                    verificado: true
                };
                localStorage.setItem('dados_cliente_temgo', JSON.stringify(dados));
                
                // Redireciona para a tela do passageiro (Mapa)
                window.location.replace("passageiro.html");
            } else {
                alert("Código inválido! Verifique seu e-mail.");
            }
        }
    </script>
</body>
</html>
